<?php


    /*
    *   @Returns the minimum and maximum validation points.
    */
    function countryMobileLength(){

        return array(
            '93' =>array('min'=>'9' ,'max'=> '9'),
            '355'=>array('min'=> '3','max'=> '9'),
            '213'=>array('min'=> '8','max'=> '9'),
            '376'=>array('min'=> '6','max'=> '9'),
            '244'=>array('min'=> '9','max'=> '9'),
            '54' =>array('min'=>'10','max'=> '10'),
            '374'=>array('min'=> '8','max'=> '8'),
            '297'=>array('min'=> '7','max'=> '7'),
            '61' =>array('min'=>'5' ,'max'=> '15'),
            '672'=>array('min'=> '6','max'=> '6'),
            '43' =>array('min'=>'4' ,'max'=> '13'),
            '994'=>array('min'=> '8','max'=> '9'),
            '973'=>array('min'=> '8','max'=> '8'),
            '880'=>array('min'=> '6','max'=> '10'),
            '375'=>array('min'=> '9','max'=> '10'),
            '32' =>array('min'=>'8' ,'max'=> '9'),
            '501'=>array('min'=> '7','max'=> '7'),
            '229'=>array('min'=> '8','max'=> '8'),
            '975'=>array('min'=> '7','max'=> '8'),
            '591'=>array('min'=> '8','max'=> '8'),
            '599'=>array('min'=> '7','max'=> '7'),
            '387'=>array('min'=> '8','max'=> '8'),
            '267'=>array('min'=> '7','max'=> '8'),
            '55' =>array('min'=>'10','max'=> '10'),
            '673'=>array('min'=> '7','max'=> '7'),
            '359'=>array('min'=> '7','max'=> '9'),
            '226'=>array('min'=> '8','max'=> '8'),
            '257'=>array('min'=> '8','max'=> '8'),
            '855'=>array('min'=> '8','max'=> '8'),
            '237'=>array('min'=> '8','max'=> '8'),
            '238'=>array('min'=> '7','max'=> '7'),
            '236'=>array('min'=> '8','max'=> '8'),
            '235'=>array('min'=> '8','max'=> '8'),
            '56' =>array('min'=>'8' ,'max'=>'9' ),
            '86' =>array('min'=>'5' ,'max'=>'12'),
            '57' =>array('min'=>'8' ,'max'=>'10'),
            '269'=>array('min'=> '7','max'=> '7'),
            '242'=>array('min'=> '9','max'=> '9'),
            '682'=>array('min'=> '5','max'=> '5'),
            '506'=>array('min'=> '8','max'=> '8'),
            '225'=>array('min'=> '8','max'=> '8'),
            '385'=>array('min'=> '8','max'=> '12'),
            '53' =>array('min'=>'6' ,'max'=>'8' ),
            '599'=>array('min'=> '7','max'=> '8'),
            '357'=>array('min'=> '8','max'=> '11'),
            '420'=>array('min'=> '4','max'=> '12'),
            '850'=>array('min'=> '6','max'=> '17'),
            '243'=>array('min'=> '5','max'=> '9'),
            '45' =>array('min'=>'8' ,'max'=>'8' ),
            '246'=>array('min'=> '7','max'=> '7'),
            '253'=>array('min'=> '6','max'=> '6'),
            '593'=>array('min'=> '8','max'=> '8'),
            '20' =>array('min'=>'7' ,'max'=>'9' ),
            '503'=>array('min'=> '7','max'=> '11'),
            '240'=>array('min'=> '9','max'=> '9'),
            '291'=>array('min'=> '7','max'=> '7'),
            '372'=>array('min'=> '7','max'=> '10'),
            '251'=>array('min'=> '9','max'=> '9'),
            '500'=>array('min'=> '5','max'=> '5'),
            '298'=>array('min'=> '6','max'=> '6'),
            '679'=>array('min'=> '7','max'=> '7'),
            '358'=>array('min'=> '5','max'=> '12'),
            '33' =>array('min'=>'9' ,'max'=>'9' ),
            '262'=>array('min'=> '9','max'=> '9'),
            '594'=>array('min'=> '9','max'=> '9'),
            '689'=>array('min'=> '6','max'=> '6'),
            '241'=>array('min'=> '6','max'=> '7'),
            '220'=>array('min'=> '7','max'=> '7'),
            '995'=>array('min'=> '9','max'=> '9'),
            '49' =>array('min'=>'6' ,'max'=>'13'),
            '233'=>array('min'=> '5','max'=> '9'),
            '350'=>array('min'=> '8','max'=> '8'),
            '30' =>array('min'=>'10','max'=> '10'),
            '299'=>array('min'=> '6','max'=> '6'),
            '590'=>array('min'=> '9','max'=> '9'),
            '502'=>array('min'=> '8','max'=> '8'),
            '224'=>array('min'=> '8','max'=> '8'),
            '245'=>array('min'=> '7','max'=> '7'),
            '592'=>array('min'=> '7','max'=> '7'),
            '509'=>array('min'=> '8','max'=> '8'),
            '504'=>array('min'=> '8','max'=> '8'),
            '852'=>array('min'=> '4','max'=> '9'),
            '36' =>array('min'=>'8' ,'max'=>'9' ),
            '354'=>array('min'=> '7','max'=> '9'),
            '91' =>array('min'=>'10','max'=>'10' ),
            '62' =>array('min'=>'5' ,'max'=>'10'),
            '870'=>array('min'=> '9','max'=> '9'),
            '800'=>array('min'=> '8','max'=> '8'),
            //'882'=>array('min'=> '0','max'=> '0'),
            //'883'=>array('min'=> '0','max'=> '0'),
            '979'=>array('min'=> '9','max'=> '9'),
            '808'=>array('min'=> '8','max'=> '8'),
            '98' =>array('min'=>'6' ,'max'=>'10'),
            '964'=>array('min'=> '8','max'=> '10'),
            '353'=>array('min'=> '7','max'=> '11'),
            '972'=>array('min'=> '8','max'=> '9'),
            '39' =>array('min'=>'1' ,'max'=>'11'),
            '81' =>array('min'=>'5' ,'max'=>'13'),
            '962'=>array('min'=> '5','max'=> '9'),
            '7'  =>array('min'=>'10' ,'max'=>'10'),
            '254'=>array('min'=> '6','max'=> '10'),
            '686'=>array('min'=> '5','max'=> '5'),
            '82' =>array('min'=>'8' ,'max'=>'11'),
            '965'=>array('min'=> '7','max'=> '8'),
            '996'=>array('min'=> '9','max'=> '9'),
            '856'=>array('min'=> '8','max'=> '10'),
            '371'=>array('min'=> '7','max'=> '8'),
            '961'=>array('min'=> '7','max'=> '8'),
            '266'=>array('min'=> '8','max'=> '8'),
            '231'=>array('min'=> '7','max'=> '8'),
            '218'=>array('min'=> '8','max'=> '9'),
            '423'=>array('min'=> '7','max'=> '9'),
            '370'=>array('min'=> '8','max'=> '8'),
            '352'=>array('min'=> '4','max'=> '11'),
            '853'=>array('min'=> '7','max'=> '8'),
            '261'=>array('min'=> '9','max'=> '10'),
            '265'=>array('min'=> '7','max'=> '8'),
            '60' =>array('min'=>'7' ,'max'=>'9' ),
            '960'=>array('min'=> '7','max'=> '7'),
            '223'=>array('min'=> '8','max'=> '8'),
            '356'=>array('min'=> '8','max'=> '8'),
            '692'=>array('min'=> '7','max'=> '7'),
            '596'=>array('min'=> '9','max'=> '9'),
            '222'=>array('min'=> '7','max'=> '7'),
            '230'=>array('min'=> '7','max'=> '7'),
            '52' =>array('min'=>'10','max'=> '10'),
            '691'=>array('min'=> '7','max'=> '7'),
            '373'=>array('min'=> '8','max'=> '8'),
            '377'=>array('min'=> '5','max'=> '9'),
            '976'=>array('min'=> '7','max'=> '8'),
            '382'=>array('min'=> '4','max'=> '12'),
            '212'=>array('min'=> '9','max'=> '9'),
            '258'=>array('min'=> '8','max'=> '9'),
            '95' =>array('min'=>'7' ,'max'=>'9' ),
            '264'=>array('min'=> '6','max'=> '10'),
            '674'=>array('min'=> '4','max'=> '7'),
            '977'=>array('min'=> '8','max'=> '9'),
            '31' =>array('min'=>'9' ,'max'=>'9' ),
            '687'=>array('min'=> '6','max'=> '6'),
            '64' =>array('min'=>'3' ,'max'=>'10'),
            '505'=>array('min'=> '8','max'=> '8'),
            '227'=>array('min'=> '8','max'=> '8'),
            '234'=>array('min'=> '7','max'=> '10'),
            '683'=>array('min'=> '4','max'=> '4'),
            '47' =>array('min'=>'5' ,'max'=>'8' ),
            '968'=>array('min'=> '7','max'=> '8'),
            '92' =>array('min'=>'8' ,'max'=>'11'),
            '680'=>array('min'=> '7','max'=> '7'),
            '507'=>array('min'=> '7','max'=> '8'),
            '675'=>array('min'=> '4','max'=> '11'),
            '595'=>array('min'=> '5','max'=> '9'),
            '51' =>array('min'=>'8' ,'max'=>'11'),
            '63' =>array('min'=>'8' ,'max'=>'10'),
            '48' =>array('min'=>'6' ,'max'=>'9' ),
            '351'=>array('min'=> '9','max'=> '11'),
            '974'=>array('min'=> '3','max'=> '8'),
            '40' =>array('min'=>'9' ,'max'=>'9' ),
            '7'  =>array('min'=>'10' ,'max'=>'10'),
            '250'=>array('min'=> '9','max'=> '9'),
            '247'=>array('min'=> '4','max'=> '4'),
            '290'=>array('min'=> '4','max'=> '4'),
            '508'=>array('min'=> '6','max'=> '6'),
            '685'=>array('min'=> '3','max'=> '7'),
            '378'=>array('min'=> '6','max'=> '10'),
            '239'=>array('min'=> '7','max'=> '7'),
            '966'=>array('min'=> '8','max'=> '9'),
            '221'=>array('min'=> '9','max'=> '9'),
            '381'=>array('min'=> '4','max'=> '12'),
            '248'=>array('min'=> '7','max'=> '7'),
            '232'=>array('min'=> '8','max'=> '8'),
            '65' =>array('min'=>'8' ,'max'=>'12'),
            '421'=>array('min'=> '4','max'=> '9'),
            '386'=>array('min'=> '8','max'=> '8'),
            '677'=>array('min'=> '5','max'=> '5'),
            '252'=>array('min'=> '5','max'=> '8'),
            '27' =>array('min'=>'9' ,'max'=>'9' ),
            '211'=>array('min'=> '1','max'=> '15'),
            '34' =>array('min'=>'9' ,'max'=>'9' ),
            '94' =>array('min'=>'9' ,'max'=>'9' ),
            '249'=>array('min'=> '9','max'=> '9'),
            '597'=>array('min'=> '6','max'=> '7'),
            '268'=>array('min'=> '7','max'=> '8'),
            '46' =>array('min'=>'7' ,'max'=>'13'),
            '41' =>array('min'=>'4' ,'max'=>'12'),
            '963'=>array('min'=> '8','max'=> '10'),
            '886'=>array('min'=> '8','max'=> '9'),
            '992'=>array('min'=> '9','max'=> '9'),
            '255'=>array('min'=> '9','max'=> '9'),
            '888'=>array('min'=> '1','max'=> '15'),
            '66' =>array('min'=>'8' ,'max'=>'9' ),
            '389'=>array('min'=> '8','max'=> '9'),
            '670'=>array('min'=> '7','max'=> '7'),
            '228'=>array('min'=> '8','max'=> '8'),
            '690'=>array('min'=> '4','max'=> '4'),
            '676'=>array('min'=> '5','max'=> '7'),
            '991'=>array('min'=> '1','max'=> '15'),
            '216'=>array('min'=> '8','max'=> '8'),
            '90' =>array('min'=>'10','max'=> '10'),
            '993'=>array('min'=> '8','max'=> '8'),
            '688'=>array('min'=> '5','max'=> '6'),
            '256'=>array('min'=> '9','max'=> '9'),
            '380'=>array('min'=> '9','max'=> '9'),
            '971'=>array('min'=> '8','max'=> '9'),
            '44' =>array('min'=>'7' ,'max'=>'10'),
            '1'  =>array('min'=>'10' ,'max'=>'10'),
            //'878'=>array('min'=> '1','max'=> '15'),
            '598'=>array('min'=> '4','max'=> '11'),
            '998'=>array('min'=> '9','max'=> '9'),
            '678'=>array('min'=> '5','max'=> '7'),
            '39' =>array('min'=>'1' ,'max'=>'11'),
            '379'=>array('min'=> '1','max'=> '11'),
            '58' =>array('min'=>'10','max'=> '10'),
            '84' =>array('min'=>'7' ,'max'=>'10'),
            '681'=>array('min'=> '6','max'=> '6'),
            '967'=>array('min'=> '6','max'=> '9'),
            '260'=>array('min'=> '9','max'=> '9'),
            '263'=>array('min'=> '5','max'=> '10')
        );

    }


	/*
	* @Push Notification Android
	*/
	function androidPushNotification($data) {
       
        $headers = array("Content-Type:" . "application/json", "Authorization:" . "key=" . Config::get('constants.API_ACCESS_KEY'));
          
		//$data=json_encode($data);
		$data=json_encode($data,true);

        $ch = curl_init();
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_URL, "https://android.googleapis.com/gcm/send");
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);

        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);

        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $data);       
        $response = curl_exec($ch);
        curl_close($ch);
        $pos = strpos($response, '"success":1');
        if ($pos == true)
            return $response;
        else
            error_log($response);
        return $response;
    }


	/*
	* @Push Notification I-phone
	*/
 	function iphonePushNotification($data) {

        $deviceToken = $data['token'];
        // Put your private key's passphrase here:
        $passphrase = Config::get('constants.passphrase');
        $pem_url=Config::get('constants.ios_pem_file_url');    
        // print_r($deviceToken."-".url($pem_url));die();
        $ctx = stream_context_create();
        stream_context_set_option($ctx, 'ssl', 'local_cert', $pem_url);
        stream_context_set_option($ctx, 'ssl', 'passphrase',  $passphrase);

        // Open a connection to the APNS server
//        $fp = stream_socket_client(
//                'ssl://gateway.sandbox.push.apple.com:2195', $err,
//                $errstr, 60, STREAM_CLIENT_CONNECT|STREAM_CLIENT_PERSISTENT, $ctx);
        $fp = stream_socket_client('ssl://gateway.push.apple.com:2195', $err, $errstr, 60, STREAM_CLIENT_CONNECT | STREAM_CLIENT_PERSISTENT, $ctx);
        // echo $fp;

        if (!$fp) {
            // exit("Failed to connect: $err $errstr" . PHP_EOL);
            return false;
        }
        //echo 'Connected to APNS' . PHP_EOL;
        // Create the payload body
        $body['aps'] = array(
            'alert' => $data['message'],
            'sound' => 'default',
           // 'msgId' =>$data['msgId'],
            //'chatType' => $chatType,
            //'sname' => $senderName
        );
    // $body['aps']['sname']=$senderName;

        // Encode the payload as JSON
        $payload = json_encode($body);

        // Build the binary notification
        $msg = chr(0) . pack('n', 32) . pack('H*', $deviceToken) . pack('n', strlen($payload)) . $payload;

        // Send it to the server
        $result = fwrite($fp, $msg, strlen($msg));

        // Close the connection to the server
        fclose($fp);
        if (!$result) {
            return false;
            //echo 'Message not delivered' . PHP_EOL;
        } else {
            return true;
            //echo 'Message successfully delivered' . PHP_EOL;
        }

    }

    function forumPostContents( $description, $ReadMoreUrl, $descriptionlength = 142){
    $data=0;
    if( !empty($description) ){
        if(strlen($description) < $descriptionlength){
            return $description;
        }
        $Description1 = substr( $description, 0 ,$descriptionlength );
        $Description2=substr( $description, strlen($Description1)-1 ,strlen($description) );
        preg_match('/[a-z]+/i', $Description2, $matches, PREG_OFFSET_CAPTURE);
        $offset=(strlen($Description1)-1)+(isset($matches[0][1])?$matches[0][1]:strlen($Description2));     
        $Description =substr( $description, 0 ,$offset); 
        if( strlen( $description ) > strlen( $Description ) ){
            $Description .= '<span class="moreellipses">...</span>';
            $data=1;
        }
    } else {
        $Description = 'NA';
    }
  /*  if($ReadMoreUrl!='')
        {
          $Description .= ' <a href="'.$ReadMoreUrl.'" class="readmore-link pull-right">Read More</a>';
        }
        else
        {
            $Description .= '<span class="morecontent"><span></span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>'
        }*/
        if($data){
            if($ReadMoreUrl == "#"){
                $btn_text = "More";
               $ReadMoreUrl="javascript:void(0);";
           }
            else
                $btn_text = "Read More";
            $hidden_text = substr($description,$descriptionlength-1,strlen($description)-1 );
            $Description .=  '<span class="morecontent"><span>'.$hidden_text.'</span>&nbsp;&nbsp;<a href="'.$ReadMoreUrl.'" class="morelink">'.$btn_text.'</a></span>';
        }

    return $Description;
}

function webEncode( $String ){
	//return base64_encode( $String );
	return $String;
}

?>
